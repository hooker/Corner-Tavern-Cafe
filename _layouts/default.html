<!doctype html>
<html lang="en">
<head>
<title>Corner Tavern & Caf√©</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/assets/css/styles.css">
<link rel="stylesheet" href="https://use.typekit.net/tss3usf.css">
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
</head>
<body class="page">
<header class="header page__header">
{% include header.html %}
</header>
<main class="menu page__menu" id="menu">
{% include menu.html %}
</main> <!-- End 'menu' section -->
<main class="features page__features" id="features">
{% include features.html %}
</main> <!-- End 'features' section -->
<main class="info page__info" id="info">
{% include info.html %}
</main> <!-- End 'info' section -->
<footer class="footer page__footer" id="contact">
{% include footer.html %}
</footer>
<script src="/assets/js/jquery-3.3.1.js"></script>
<script>
$( document ).ready(function() {
	function Bounds(top, bottom) {
		// sanity check the order of the values
		if (top <= bottom) {
			this.top = top;
			this.bottom = bottom;
		} else {
			this.top = bottom;
			this.bottom = top;
		}
	}
	Bounds.prototype.getSelectionBounds = function($selection) {
		let topOfSelection = $selection.offset().top;
		let bottomOfSelection = topOfSelection + $selection.height();
		
		return new Bounds(topOfSelection, bottomOfSelection);
	}
	Bounds.prototype.intersects = function(referenceBounds) {
		if ((
		     (referenceBounds.top > this.top) && 
		     (referenceBounds.top < this.bottom)
			) || (
		     (referenceBounds.bottom > this.top) &&
		     (referenceBounds.bottom < this.bottom)
		    ) || (
		     (referenceBounds.top < this.top) &&
		     (referenceBounds.bottom > this.bottom)
		    )
		   ) {
			return true;
		} else {
			return false;
		}
	}
	Bounds.prototype.toString = function () {
		return '<Bounds: top: ' + this.top + ', bottom: ' + this.bottom + '>';
	}
	
	/* An array of all the facade sign classes */
	var facadeElementNames = [
				   "facade__breakfast",
				   "facade__daytime",
				   "facade__signature-cocktails",
				   "facade__signature-cocktails-hot",
				   "facade__spirits",
				   "facade__features",
				   "facade__info",
				   "facade__contact",
				   "facade__contact-door",
				  ];
	/* An array of all the IDs that will trigger a sign */
	var triggerIds = [
					  "#breakfast",
					  "#daytime",
					  "#signatureCocktails",
					  "#signatureCocktailsHot",
					  "#spirits",
					  "#features",
					  "#info",
					  "#contact",
					  "#contactDoor",
					 ];
	
	/* 
	** All of the arrays need to be the same size. The application depends
	** on the array elements being indexed the same.
	*/
	if (facadeElementNames.length !== triggerIds.length) {
		throw "Mismatched number of facade signs and trigger ids.";
	}
	/* An array of JQuery selectors for each of the facade signs */
	var $facades = new Array(facadeElementNames.length);
	/* An array of top and bottom bounds for each of the trigger ids */
	var triggerIdsBounds = new Array(triggerIds.length);
	
	/* Populate the facade sign selector array with JQuery selectors */
	facadeElementNames.forEach(function(item, index, array) {
		// Select the facade 
		let $facade = $( '.' + item );
		// Make sure an item was selected
		if ($facade.length === 0) {
			console.log("Unable to find a facade sign class with the name: '" +
						item + "'.");
			return; // end execution for this item in the forEach loop
		}
		$facades[index] = $facade.first(); // There should only be one.
	});
	
	/* 
	** Populate the boundaries array with Bounds for each trigger id.
	*/
	triggerIds.forEach(function(item, index, array) {
		// Select the trigger id 
		let $triggerId = $( item );
		// Make sure an item was selected
		if ($triggerId.length === 0) {
			console.log("Unable to find an ID with the name: '" + item + "'.");
			return; // end execution for this item in the forEach loop
		}
		// Create a Bounds object for this trigger
		let bounds = Bounds.prototype.getSelectionBounds($triggerId.first());
		// Add the Bounds object to the bounds array
		triggerIdsBounds[index] = bounds;
	});
		
	var getCurrentTriggerAreaBounds = function($window) {
		let $header = $( ".header" ); // TODO: The DOM is queried on each call. Fix.
		/* Use the header height to offset the area to watch */
		let top = $window.scrollTop() + $header.outerHeight();
		let bottom = $window.scrollTop() + $window.height();

		return new Bounds(top, bottom);	
	}
	
	var scrollTimeout; // global variable to limit scroll handler frequency
	var scrollHandler = function() {
		let triggerAreaBounds = getCurrentTriggerAreaBounds($window);
		
		triggerIdsBounds.forEach(function(item, index, array) {
			let $correspondingFacadeElement = $facades[index];
			let correspondingFacadeElementName = facadeElementNames[index];
			if (item.intersects(triggerAreaBounds)) {
				$correspondingFacadeElement.addClass( correspondingFacadeElementName + '_lit' );
			} else {
				$correspondingFacadeElement.removeClass( correspondingFacadeElementName + '_lit' );
			}
		});
		
		scrollTimeout = clearTimeout(scrollTimeout);
	};
	
	/* First cache the window selector */
	var $window = $( window );
	
	/* Check if the resize resulted in a change of visible triggers */
	$window.resize(function( event ) {
		console.log("Trigger area changed: " + getCurrentTriggerAreaBounds($window));
		scrollHandler(); // TODO: I may need to consider scrollTimeout
	});
	
	/* Handle scroll events */
	$window.scroll(function( event ) {
		if (!scrollTimeout) {		
			scrollTimeout = setTimeout(scrollHandler, 500);
		}
	});
	
	// Initial check to see if any elements should display
	scrollHandler();
});
</script>
</body>
</html>